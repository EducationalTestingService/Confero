<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>UserMonitor RT Feedback v 0.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <script>
        window.open    = function(){};
        window.print   = function(){};
        // Support hover state for mobile.
        if (false) {
          window.ontouchstart = function(){};
        }

        function __linkClick(e) {
          parent.window.postMessage(this.href, '*');
        };

        function __bindToLinks() {
          var __links = document.querySelectorAll('a');
          for (var i = 0, l = __links.length; i < l; i++) {
            if ( __links[i].getAttribute('data-t') == '_blank' ) {
              __links[i].addEventListener('click', __linkClick, false);
            }
          }
        }
    </script>
	<!--link rel="stylesheet/less" href="less/bootstrap.less" type="text/css" /-->
	<!--link rel="stylesheet/less" href="less/responsive.less" type="text/css" /-->
	<!--script src="js/less-1.3.3.min.js"></script-->
	<!--append â€˜#!watchâ€™ to the browser URL, then refresh the page. -->
	
	<link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/bootstrap-multiselect.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/bootselect/bootstrap-select.css">
	<link href="/static/css/style.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="/static/js/html5shiv.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/static/img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="/static/img/favicon.png">
</head>

<body class style>
-	 <div id="fullDiv">
        <div class="modal fade" id="experimentSelectionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
                <h4 class="modal-title" id="myModalLabel">Select Experiment</h4>
              </div>
              <div id="experimentSelectionBody" class="modal-body">
                  <div id="experimentSelectionContent">
                    <span>The UserMonitor Data Collection application must be running before an experiment name can be selected.</span>
                  </div>
                  <select id='experimentSelectionList' disabled class='selectpicker expNamePicker show-tick' data-live-search='true' data-style='btn-primary' data-width='auto' data-size=5>
                  </select>
              </div>
              <div class="modal-footer">
<!--                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
                <button type="button" id="experimentSelectionModalButton" class="btn btn-primary disabled">Waiting...</button>
              </div>
            </div>
          </div>
        </div>
    </div>
    <div class="container">
        <div class="row clearfix">
           <nav id="navbarDIV" class="navbar navbar-default" role="navigation">
            <div class="col-md-12 column">
                    <div class="navbar-header">
                         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                             <span class="sr-only">Toggle navigation</span>
                             <span class="icon-bar"></span>
                             <span class="icon-bar"></span>
                            <!-- <span class="icon-bar"></span> -->
                         </button>
                        <a class="navbar-brand" href="#">UserMonitor</a>
                    </div>
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li class="btn-toolbar" role="toolbar">
                            <div class="btn-group" data-toggle="buttons">
                               <label id="newSessionButton" class="btn btn-default navbar-btn">
                                <input type="radio" name="options">
                                <span id="newSessionSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Start a New Experiment Session"
                                      class="glyphicon glyphicon-file">
                               </span>
                              </label>
                              <label id="closeSessionButton" class="btn btn-default navbar-btn disabled">
                                <input type="radio" name="options">
                                <span id="closeSessionSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Close Current Experiment Session"
                                      class="glyphicon glyphicon-folder-close">
                               </span>
                              </label>
                            </div>

                            <div class="btn-group" data-toggle="buttons">
                              <label class="btn btn-default navbar-btn disabled" id="startRecordButton">
                                <input type="radio" name="options">
                                <span id="startRecordSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Start Recording Data"
                                      class="glyphicon glyphicon-record">
                                </span>
                              </label>
                              <label class="btn btn-default navbar-btn disabled" id="stopRecordButton">
                                <input type="radio" name="options">
                                <span  id="stopRecordSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Stop Recording Data"
                                      class="glyphicon glyphicon-stop">
                                      </span>
                              </label>
                              </div>

                            <div class="btn-group" data-toggle="buttons">
                              <label class="btn btn-default navbar-btn disabled" id="startCalibrationButton">
                                <input type="checkbox" name="options">
                                <span id="startCalibrationSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Start Eye Tracker Calibration"
                                      class="glyphicon glyphicon-screenshot">
                                </span>
                              </label>
                              <label class="btn btn-default navbar-btn disabled" id="startValidationButton">
                                <input type="checkbox" name="options">
                                <span  id=startValidationSpan"
                                      data-toggle="tooltip"
                                      data-placement="bottom"
                                      data-original-title="Tooltip on bottom"
                                      title="Start Eye Tracker Validation"
                                      class="glyphicon glyphicon-plus-sign">
                                      </span>
                              </label>
                            </div>
                            </li>
                        </ul>
                        <form class="navbar-form navbar-left" role="search">
                            <div class="form-group">
                                <input id="msgLogText" type="text" class="form-control">
                            </div>
                            <button id="submitExperimentMessage"
                                    class="btn btn-default disabled" type="button"
                                    data-toggle="tooltip" data-placement="right"
                                    data-original-title="Tooltip on right"
                                    title="Save Message Event">
                                <span class="glyphicon glyphicon-send"></span>
                            </button>
                        </form>
                        <ul class="nav navbar-nav navbar-right">
						<select class="multiselect" id="selectedStatsPanels" multiple="multiple">
							<option value="#systemStatusPanel" selected>System</option>
							<option value="#eyetrackerStatusPanel" selected>Eye Tracker</option>
							<option value="#mouseStatusPanel" selected>Mouse</option>
							<option value="#keyboardStatusPanel" selected>Keyboard</option>
						</select>

                            <button id="shutdownSoftwareButton"
                                    class="btn navbar-btn btn-primary"
                                    type="button">
                                        <span id="shutdownSoftwareSpan"
                                              data-toggle="tooltip"
                                              data-placement="left"
                                              data-original-title="Tooltip on left"
                                              title="Quit All UserMonitor Applications"
                                              class="glyphicon glyphicon-off">
                                        </span>
                            </button>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div class="row clearfix">
            <div id="canvasDIV" class="col-md-8 column" style="padding-left: 0;">
                <div class="btn-group" data-toggle="buttons">
                  <label class="btn btn-default btn-xs">
                    <input type="checkbox">
                    <span id="gazeOverlayButton" class="glyphicon glyphicon-eye-open"
                          data-toggle="tooltip"
                          data-placement="top"
                          data-original-title="Tooltip on top"
                          title="Overlay Gaze Position">
                    </span>
                  </label>
                  <label class="btn btn-default btn-xs">
                    <input type="checkbox">
                    <span id="mouseOverlayButton" class="glyphicon glyphicon-arrow-up"
                          data-toggle="tooltip"
                          data-placement="top"
                          data-original-title="Tooltip on top"
                          title="Overlay Mouse Position">
                    </span>
                  </label>
                  <label class="btn btn-default btn-xs">
                    <input type="checkbox">
                    <span id="timeOverlayButton" class="glyphicon glyphicon-time"
                          data-toggle="tooltip"
                          data-placement="top"
                          data-original-title="Tooltip on top"
                          title="Overlay Time">
                    </span>
                  </label>
                </div>
                 <canvas id="videoCanvas" width="{{video_canvas_width}}" height="{{video_canvas_height}}">
                    <p>
                        Please use a browser that supports the Canvas Element, like
                        <a href="http://www.google.com/chrome">Chrome</a>,
                        <a href="http://www.mozilla.com/firefox/">Firefox</a>,
                        <a href="http://www.apple.com/safari/">Safari</a> or Internet Explorer 10
                    </p>
                </canvas>
            </div>
            <div class="col-md-4 column">
                <div id="statusPanelGroup" class="panel-group">
                    <div id="systemStatusPanel" class="panel panel-default" style="font-size: 10px">
                        <div class="panel-heading">
                            <h5 class="panel-title">
                                <a data-toggle="collapse" href="#collapseSystemStatus">
                                System Status
                                </a>

                            </h5>
                        </div>
                        <div id="collapseSystemStatus" class="panel-collapse collapse in">
                            <div class="panel-body">
                               <div class="table-responsive">
                                   <!--
                                    #input_computer_disk_usage_read_kb_per_sec
                                    #input_computer_disk_usage_write_kb_per_sec
                                    #input_computer_disk_usage_read_time_perc
                                    #input_computer_disk_usage_write_time_perc

                                   -->
                                   <table class="table table-condensed table-hover table-bordered">
                                      <thead>
                                        <tr>
                                            <th></th>
                                            <th><h6>Data Monitor</h6></th>
                                            <th><h6>Feedback Server</h6></th>
                                        </tr>
                                    </thead>
                                      <tbody>
                                        <tr>
                                          <td><h6>Experiment Code</h6></td>
                                          <td id="experiment_session_experiment_name" colspan="2"> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Session Code</h6></td>
                                          <td id="experiment_session_code" colspan="2"> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Recording Data</h6></td>
                                          <td id="experiment_session_recording" colspan="2"> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Recording Block</h6></td>
                                          <td id="experiment_session_recording_counter" colspan="2"> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Session Duration</h6></td>
                                          <td id="input_computer_up_time" colspan="2"> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>CPU Usage</h6></td>
                                          <td id="input_computer_cpu_usage_all"> - </td>
                                          <td> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Memory Usage</h6></td>
                                          <td id="input_computer_memory_usage_all"> - </td>
                                          <td> - </td>
                                        </tr>
                                        <tr>
                                          <td><h6>Disk Read / Write</h6></td>
                                          <td>
                                              <span id="input_computer_disk_usage_read_kb_per_sec"></span>
                                              <span> / </span>
                                              <span id="input_computer_disk_usage_write_kb_per_sec"></span>
                                          </td>
                                          <td> - </td>
                                        </tr>
                                        <tr>
                                        <td><h6>Network Rx / Tx</h6></td>
                                          <td>
                                              <span id="input_computer_network_usage_kb_recv_per_sec"></span>
                                              <span> / </span>
                                              <span id="input_computer_network_usage_kb_sent_per_sec"></span>
                                          </td>
                                          <td> - </td>
                                        </tr>
                                      </tbody>
                                   </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="eyetrackerStatusPanel" class="panel panel-default" style="font-size: 10px">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" href="#collapseEyeTrackerStatus">
                                        EyeTracker Status
                                    </a>
                                </h4>
                            </div>
                            <div id="collapseEyeTrackerStatus" class="panel-collapse collapse in">
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed table-hover table-bordered">
                                            <tbody>
                                               <tr>
                                                    <td colspan="2"><h6>Model</h6></td>
                                                    <td id="eyetracker_model"> - </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><h6>Recording</h6></td>
                                                    <td id="eyetracker_recording"> - </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><h6>Gaze Position</h6></td>
                                                    <td id="eyetracker_gaze_position"> - </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><h6>Current Time</h6></td>
                                                    <td id="eyetracker_time"> - </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><h6>Last Event</h6></td>
                                                    <td id="eyetracker_type"> - </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><h6>Event Time</h6></td>
                                                    <td id="eyetracker_last_event_time"> - </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--<div class="table-responsive">
                                    <table class="table table-condensed table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th><h6>Left Eye</h6></th>
                                                <th><h6>Right Eye</h6></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                             <tr>
                                                <td ><h6>Status</h6></td>
                                                <td id="et_left_eye_status">  -  </td>
                                                <td id="et_right_eye_status">  -  </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>State</h6></td>
                                                <td id="et_left_eye_state"> - </td>
                                                <td id="et_right_eye_state"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Gaze</h6></td>
                                                <td id="et_left_eye_gaze"> - </td>
                                                <td id="et_right_eye_gaze"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Eye Camera Position</h6></td>
                                                <td id="et_left_eye_pos"> - </td>
                                                <td id="et_right_eye_pos"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Pupil Size</h6></td>
                                                <td id="et_left_eye_pupil"> - </td>
                                                <td id="et_right_eye_pupil"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Noise</h6></td>
                                                <td id="et_left_eye_noise"> - </td>
                                                <td id="et_right_eye_noise"> - </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>-->
                            </div>
                        </div>
                    </div>
                    <div id="mouseStatusPanel" class="panel panel-default"  style="font-size: 10px">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" href="#collapseMouseInfo">
                                    Mouse Events
                                </a>
                            </h4>
                        </div>
                        <div id="collapseMouseInfo" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-condensed table-hover table-bordered ">
                                        <tbody>
                                        <!--
                                        Mouse Device:
                                            x #mouse_buttons: 0
                                            #mouse_countdown_time: 0.035
                                            #mouse_duration: 21.1276513794
                                            #mouse_events: Array[2]
                                            x #mouse_last_event_time: 26.3986960399
                                            x #mouse_modifiers: Array[0]
                                            x #mouse_position: Array[2]
                                                0: -927
                                                1: -166
                                                length: 2
                                                __proto__: Array[0]
                                            x #mouse_recording: true
                                            x #mouse_scroll: 0
                                            x #mouse_type: "MOUSE_MOVE"
                                            #mouse_above_object
                                            #mouse_window_id: 1836978
                                        -->
                                            <tr>
                                                <td><h6>Recording</h6></td>
                                                <td id="mouse_recording"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Last Event</h6></td>
                                                <td id="mouse_type"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Event Time</h6></td>
                                                <td id="mouse_last_event_time"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Position</h6></td>
                                                <td id="mouse_position"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Buttons</h6></td>
                                                <td id="mouse_buttons"> - </h6></td>
                                            </tr>
                                            <tr>
                                                <td><h6>Modifiers</h6></td>
                                                <td id="mouse_modifiers"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Vertical Scroll</h6></td>
                                                <td id="mouse_scroll"> - </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="keyboardStatusPanel" class="panel panel-default" style="font-size: 10px">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" href="#collapseKeyboardInfo">
                                    Keyboard Events
                                </a>
                            </h4>
                        </div>
                        <div id="collapseKeyboardInfo" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-condensed table-hover table-bordered">
                                        <tbody>
                                        <!--
                                        Keyboard Device
                                            x #keyboard_auto_repeated: 0
                                            #keyboard_connected: true
                                            #keyboard_countdown_time: 0.1
                                            #keyboard_duration: 21.0906355281
                                            #keyboard_events: Array[4]
                                            x #keyboard_key: "d"
                                            #keyboard_key_id: 68
                                            x #keyboard_last_event_time: null
                                            x #keyboard_modifiers: Array[0]
                                            X #keyboard_recording: true
                                            #keyboard_scan_code: 32
                                            x #keyboard_type: "KEYBOARD_CHAR"
                                            #keyboard_ucode: 100
                                            #keyboard_window_id: 197858
                                        -->
                                            <tr>
                                                <td><h6>Recording</h6></td>
                                                <td id="keyboard_recording"> - </td>
                                            </tr>
                                            <tr>
                                                <td ><h6>Last Event</h6></td>
                                                <td id="keyboard_type"> - </td>
                                            </tr>
                                             <tr>
                                                <td><h6>Event Time</h6></td>
                                                <td id="keyboard_last_event_time"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Char</h6></td>
                                                <td id="keyboard_key"> - </td>
                                             </tr>
                                            <tr>
                                                <td><h6>Auto Repeats</h6></td>
                                                <td id="keyboard_auto_repeated"> - </td>
                                            </tr>
                                            <tr>
                                                <td><h6>Modifiers</h6></td>
                                                <td id="keyboard_modifiers"> - </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/bootstrap-multiselect.js"></script>
    <script type="text/javascript" src="static/bootselect/bootstrap-select.js"></script>
    <script type="text/javascript" src="static/js/jsmpg.js"></script>
    <script type="text/javascript" src="static/js/jquery.bootstrap-growl.js"></script>
    <script type="text/javascript" src="static/js/bootbox.js"></script>
    <script type="text/javascript" src="static/js/userMonitorClientState.js"></script>
    <script type="text/javascript" src="static/js/scripts.js"></script>
    <script type="text/javascript">
        var server_websocket= createWebSocket(umf_state,'{{ video_server_host }}');
        // Show loading notice on video canvas
        var canvas = document.getElementById('videoCanvas');
        // Setup the WebSocket connection and start the player
        var client = new WebSocket( 'ws://{{ video_server_host }}:{{ video_server_port }}/' );
        var player = new jsmpeg(client, {canvas:canvas, ondecodeframe:onDecodeWsVideoFrame});

         $(document).ready(function(){

            bootbox.setDefaults({show: false})
            $('#newSessionSpan').tooltip();
            $('#closeSessionSpan').tooltip();
            $('#startRecordSpan').tooltip();
            $('#stopRecordSpan').tooltip();
            $('#submitExperimentMessage').tooltip();
            $('#shutdownSoftwareSpan').tooltip();

            $('.multiselect').multiselect({
                  buttonText: function(options, select) {
                    return "Status Panels" + ' <b class="caret"></b>';
                    },
                  onChange: function(option, select){
                     if (select == false)
                        $(option[0].value).appendTo($("#statusPanelHolder"));
                     else
                        $(option[0].value).appendTo($("#statusPanelGroup"));
                  }
            });

             $('.btn').button();
             $('.expNamePicker').selectpicker();

             $('#experimentSelectionModal').modal('show');

             $('#experimentSelectionModalButton').on('click', function(event) {
                umf_state.active_experiment_name=$('.expNamePicker')[0].value;
                var sendmsg=JSON.stringify({type:'EXPERIMENT_SELECTED', name: umf_state.active_experiment_name});
                server_websocket.send(sendmsg);
                $('#experimentSelectionModal').modal('hide');
               });


            //$.bootstrapGrowl("My message1",{delay: 40000000});
            //$.bootstrapGrowl("another message, yay!", {
            //  ele: 'body', // which element to append to
            //  type: 'info', // (null, 'info', 'error', 'success')
            //  offset: {from: 'top', amount: 20}, // 'top', or 'bottom'
            //  align: 'right', // ('left', 'right', or 'center')
            //   width: 250, // (integer, or 'auto')
            //  delay: 4000, // Time while the message will be displayed. It's not equivalent to the *demo* timeOut!
            //  allow_dismiss: true, // If true then will display a cross to close the popup.
            //  stackup_spacing: 10 // spacing between consecutively stacked growls.
            //});
            // >>> Navigation JS
            $('#shutdownSoftwareButton').on('click', function() {
                var box=bootbox.confirm("Are you sure you want to shut down the UserMonitor software?", function(result) {
                  if (result === false) {
                    $.bootstrapGrowl("Software Shutdown Cancelled",{type:'info'});
                    $('#shutdownSoftwareButton').removeClass('active');
                  } else {
                         window.location = '/shutdown';
                        }
                 });
                box.modal("show").css({
                        'margin-top': function () { //vertical centering
                                        return -($(this).height() / 2);
                                        },
                        'margin-left': function () { //Horizontal centering
                                        return -($('#navbarDIV').width() / 2);
                                        }
                });
            });

            $('#newSessionButton').on('click', function() {
                var box=bootbox.prompt("Enter New Session Code:", function(result) {
                  if (result === null) {
                    $.bootstrapGrowl("Create Session Cancelled",{type:'default'});
                  } else {
                    if (result !== ''){
                        var sendmsg=JSON.stringify({type:'START_EXP_SESSION', code: result});
                        server_websocket.send(sendmsg);
                        }
                    else
                        $.bootstrapGrowl("Session Not Created.",{type:'error'});
                    }
                 });
                box.modal("show").css({
                        'margin-top': function () { //vertical centering
                                        return -($(this).height() / 2);
                                        },
                        'margin-left': function () { //Horizontal centering
                                        return -($('#navbarDIV').width() / 2);
                                        }
                });



            });

            $('#closeSessionButton').on('click', function() {
                var box = bootbox.confirm("Permanently Close the Current Experiment Session?", function(result) {
                  if (result === false) {
                    $.bootstrapGrowl("Close Session Cancelled",{type:'info'});
                  } else {
                         var sendmsg=JSON.stringify({type:'CLOSE_EXP_SESSION'});
                         server_websocket.send(sendmsg);
                        }
                 });

                box.modal("show").css({
                        'margin-top': function () { //vertical centering
                                        return -($(this).height() / 2);
                                        },
                        'margin-left': function () { //Horizontal centering
                                        return -($('#navbarDIV').width() / 2);
                                        }
                });

            });

            $('#startRecordButton').on('click', function() {
                var sendmsg=JSON.stringify({type:'START_RECORDING'});
                server_websocket.send(sendmsg);
             });


            $('#stopRecordButton').on('click', function() {
                var sendmsg=JSON.stringify({type:'STOP_RECORDING'});
                server_websocket.send(sendmsg);
            });

            $('#startCalibrationButton').on('click', function() {
                var sendmsg=JSON.stringify({type:'START_EYETRACKER_CALIBRATION'});
                server_websocket.send(sendmsg);
                changeButtonStates([],['startCalibrationButton','startValidationButton','startRecordButton','newSessionButton','submitExperimentMessage'],[],[])
            });

            $('#startValidationButton').on('click', function() {
                var sendmsg=JSON.stringify({type:'START_EYETRACKER_VALIDATION'});
                server_websocket.send(sendmsg);
                changeButtonStates([],['startCalibrationButton','startValidationButton','startRecordButton','newSessionButton','submitExperimentMessage'],[],[])
            });


            $('#submitExperimentMessage').on('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                var sendmsg=JSON.stringify({type:'experiment_message',category:"feedback_log",text:$("#msgLogText")[0].value});
                server_websocket.send(sendmsg);
                //console.log($("#msgLogText").value());
                //alert(args);
            });

			// process the form
			$('form').submit(function(event) {
				event.preventDefault();
                event.stopPropagation();

                var sendmsg=JSON.stringify({type:'experiment_message',category:"feedback_log",text:$("#msgLogText")[0].value});
                server_websocket.send(sendmsg);

				// stop the form from submitting and refreshing
			});

            $('#gazeOverlayButton').on('click', function(event) {
                umf_state.toggleOverlayType(event.currentTarget.parentNode.classList,'gaze');
            });

            $('#mouseOverlayButton').on('click', function(event) {
                umf_state.toggleOverlayType(event.currentTarget.parentNode.classList,'mouse');
            });

            $('#timeOverlayButton').on('click', function(event) {
                umf_state.toggleOverlayType(event.currentTarget.parentNode.classList,'time');
            });

             // <<< Nav. JS

            // >>> Modal Dialog JS
            // Handles js part of loading modal dialogs centered in window.
            $('.modal').on('shown.bs.modal', function() {
                $(this).find('.modal-dialog').css({
                    'margin-top': function () {
                        return -($(this).outerHeight() / 2);
                    },
                    'margin-left': function () {
                        return -($(this).outerWidth() / 2);
                    }
                });
            });

            // <<< Modal JS

    });
    </script>
</body>
<div id="statusPanelHolder" hidden="hidden">

</div>
</html>
